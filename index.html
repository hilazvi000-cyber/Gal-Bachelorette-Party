/*
  App.jsx
  A polished, GitHub-ready single-file React component for your Bachelorette Weekend schedule.

  Usage / Notes:
  - Requires: React 18+, Tailwind CSS, lucide-react icons.
  - Recommended project setup: Create React App / Vite + Tailwind. Place this file under src/ (e.g. src/App.jsx).
  - Install icons: `npm i lucide-react`
  - Tailwind: follow official Tailwind + CRA/Vite instructions.
  - Fonts: the component loads Google fonts via <link>; in a production repo prefer index.html or CSS import.

  Accessibility & Improvements included:
  - RTL support via dir="rtl" on app container and semantic HTML.
  - Keyboard support: Escape closes the sidebar.
  - Prevent body scroll when sidebar open.
  - Simple focus management: focus returns to menu button on close.
  - Clean modular structure and comments for maintainability.
*/

import React, { useEffect, useRef, useState } from 'react';
import {
  Home,
  Plane,
  ShoppingBag,
  Sun,
  PlaneTakeoff,
  Menu,
  X,
} from 'lucide-react';

// ---------------------
// Schedule data
// ---------------------
const scheduleData = {
  day1: {
    title: 'יום ראשון: הגענו!',
    icon: Plane,
    activities: [
      "טיסה ודרכי הגעה (מלאות התרגשות!)",
      "צ'ק-אין למלון והתמקמות בסטייל.",
      "יוצאות לסיבוב ראשון בשדרה המרכזית של רומא.",
      "חוזרות לחדר להתארגנות קלה ודרינק פתיחה.",
      'ערב: מסעדת ערב איטלקית לפתוח את הטיול. 🍝',
    ],
  },
  day2: {
    title: 'יום שני: שופינג ומשהו מיוחד',
    icon: ShoppingBag,
    activities: [
      'ארוחת בוקר וקפוצ\'ינו של בוקר.',
      'מסתובבים בעיר ועושים שופינג (כי מגיע לנו!).',
      {
        type: 'special',
        title: 'הולכות למקום מיוחד ברומא! (בלי לשבור קופה 💰)',
        optionsTitle: 'אופציות חינמיות לבחירה:',
        options: [
          'מזרקת טרווי (Fontana di Trevi)',
          'המדרגות הספרדיות (Piazza di Spagna)',
          'גני התפוזים (Giardino degli Aranci)',
          'שיטוט בטרסטוורה (Trastevere)',
          'הפנתיאון (Pantheon)',
        ],
      },
      'חוזרות למלון להתארגן, מוזיקה בפול ווליום.',
      'ערב בחדר: משחקי חברה, אלכוהול וצחוקים. 🥂',
      'ערב: יוצאות למסעדה שווה במיוחד.',
    ],
  },
  day3: {
    title: 'יום שלישי: פאשן ושיק',
    icon: Sun,
    activities: [
      'ארוחת בוקר מוקדמת (יחסית...).',
      'יוצאות לסיור אופנה ברומא (כי מגיע לנו!).',
      'ממשיכות להסתובב עוד בעיר, אולי שופינג השלמות?',
      "ג'לאטו חובה! 🍦",
      'ערב: מסעדת ערב אחרונה ומפנקת במיוחד.',
    ],
  },
  day4: {
    title: 'יום רביעי: ביי ביי רומא',
    icon: PlaneTakeoff,
    activities: [
      'ארוחת בוקר אחרונה (והרבה קפה).',
      "מתכוננים לצ'ק-אאוט ועוזבים את המלון.",
      'עוד סיבוב קטן בעיר לקניות אחרונות ומזכרות.',
      'יציאה לשדה התעופה. 💔',
      '(חוזרות לארץ עם מלא חוויות וגעגועים).',
    ],
  },
};

// ---------------------
// Fonts & styles
// ---------------------
const amaticStyle = { fontFamily: "'Amatic SC', cursive" };
const containerFont = { fontFamily: "'Heebo', sans-serif" };

// ---------------------
// Header
// ---------------------
function AppHeader({ setIsMenuOpen, view }) {
  const getTitle = () => {
    if (view === 'home') return ''; // hide title on home
    if (scheduleData[view]) return scheduleData[view].title;
    return "הלו'ז שלנו";
  };

  return (
    <header
      className="flex items-center justify-between p-4 bg-orange-50 sticky top-0 z-20 w-full"
      dir="rtl"
    >
      <h2 style={amaticStyle} className="text-3xl text-red-900 font-bold truncate" aria-live="polite">
        {getTitle()}
      </h2>

      <button
        onClick={() => setIsMenuOpen(true)}
        className="text-red-900 p-2 rounded-full hover:bg-red-100 transition-colors"
        aria-label="פתיחת תפריט"
        aria-haspopup="true"
      >
        <Menu size={24} />
      </button>
    </header>
  );
}

// ---------------------
// Sidebar (drawer)
// ---------------------
function Sidebar({ isOpen, setIsMenuOpen, setView }) {
  const menuButtonRef = useRef(null);

  const menuItems = [
    { key: 'home', text: 'דף הבית', icon: Home },
    { key: 'day1', text: 'יום 1: הגענו!', icon: Plane },
    { key: 'day2', text: 'יום 2: שופינג', icon: ShoppingBag },
    { key: 'day3', text: 'יום 3: פאשן', icon: Sun },
    { key: 'day4', text: 'יום 4: ביי ביי', icon: PlaneTakeoff },
  ];

  const navigate = (view) => {
    setView(view);
    setIsMenuOpen(false);
  };

  // Close on Escape
  useEffect(() => {
    const onKey = (e) => {
      if (e.key === 'Escape') setIsMenuOpen(false);
    };
    if (isOpen) document.addEventListener('keydown', onKey);
    return () => document.removeEventListener('keydown', onKey);
  }, [isOpen, setIsMenuOpen]);

  return (
    <>
      {/* backdrop */}
      <div
        className={`fixed inset-0 bg-black/50 z-30 transition-opacity ${isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}
        onClick={() => setIsMenuOpen(false)}
        aria-hidden={!isOpen}
      />

      {/* drawer */}
      <aside
        className={`fixed top-0 right-0 bottom-0 w-72 bg-orange-50 shadow-xl z-40 transition-transform ${
          isOpen ? 'translate-x-0' : 'translate-x-full'
        }`}
        dir="rtl"
        aria-hidden={!isOpen}
      >
        <div className="flex items-center justify-between p-4 border-b border-red-200">
          <h3 style={amaticStyle} className="text-3xl text-red-900 font-bold">
            תפריט
          </h3>
          <button
            onClick={() => setIsMenuOpen(false)}
            className="text-red-900 p-2 rounded-full hover:bg-red-100 transition-colors"
            aria-label="סגירת תפריט"
            ref={menuButtonRef}
          >
            <X size={24} />
          </button>
        </div>

        <nav className="p-4 space-y-2" aria-label="ניווט הלו'ז">
          {menuItems.map((item) => (
            <button
              key={item.key}
              onClick={() => navigate(item.key)}
              className="w-full flex items-center p-3 rounded-lg text-right text-lg text-red-900 hover:bg-red-100 transition-colors"
            >
              <item.icon size={20} className="ml-3 flex-shrink-0" />
              <span>{item.text}</span>
            </button>
          ))}
        </nav>
      </aside>
    </>
  );
}

// ---------------------
// Home page
// ---------------------
function HomePage() {
  return (
    <main className="flex flex-col h-full" dir="rtl" role="main">
      <div className="text-center p-10 bg-orange-50 flex-grow flex flex-col items-center justify-center">
        <h1 style={amaticStyle} className="text-6xl sm:text-7xl font-bold text-red-900">
          Gal's Bachelorette Weekend!
        </h1>
        <p style={amaticStyle} className="text-4xl text-red-900 mt-2">
          ♥
        </p>
      </div>
    </main>
  );
}

// ---------------------
// Day view
// ---------------------
function DayView({ dayData }) {
  return (
    <section className="flex flex-col h-full" dir="rtl" aria-labelledby="day-title">
      <ul className="p-6 space-y-4 text-red-900 text-lg overflow-y-auto flex-grow">
        {dayData.activities.map((activity, index) => {
          if (typeof activity === 'string') {
            return (
              <li key={index} className="flex items-start">
                <span className="text-red-900 ml-3 mt-1 flex-shrink-0">◆</span>
                <span>{activity}</span>
              </li>
            );
          }

          if (activity.type === 'special') {
            return (
              <li key={index}>
                <div className="flex items-start">
                  <span className="text-red-900 ml-3 mt-1 flex-shrink-0">◆</span>
                  <span className="font-semibold">{activity.title}</span>
                </div>

                <div className="mt-3 mr-6 p-4 bg-orange-100 rounded-lg border-l-4 border-red-200">
                  <h4 className="font-bold text-red-900 mb-2">{activity.optionsTitle}</h4>
                  <ul className="list-decimal list-inside space-y-1 text-red-700">
                    {activity.options.map((opt, i) => (
                      <li key={i}>{opt}</li>
                    ))}
                  </ul>
                </div>
              </li>
            );
          }

          return null;
        })}
      </ul>
    </section>
  );
}

// ---------------------
// Main App
// ---------------------
export default function App() {
  const [view, setView] = useState('home');
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const menuButtonRef = useRef(null);

  // Prevent body scroll when sidebar is open
  useEffect(() => {
    document.body.style.overflow = isMenuOpen ? 'hidden' : '';
    return () => {
      document.body.style.overflow = '';
    };
  }, [isMenuOpen]);

  // Return focus to the menu button when closing sidebar
  useEffect(() => {
    if (!isMenuOpen && menuButtonRef.current) menuButtonRef.current.focus();
  }, [isMenuOpen]);

  const renderView = () => {
    if (view === 'home') return <HomePage />;
    if (scheduleData[view]) return <DayView dayData={scheduleData[view]} />;
    return <HomePage />;
  };

  return (
    <div
      className="bg-gray-100 min-h-screen p-4 flex items-center justify-center"
      style={containerFont}
      dir="rtl"
    >
      <div className="w-full max-w-md bg-orange-50 rounded-2xl shadow-xl overflow-hidden relative" style={{ height: '90vh', minHeight: '600px' }}>
        {/* Prefer to load Google fonts in index.html for production; kept here for convenience */}
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossOrigin="" />
        <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&family=Amatic+SC:wght@700&display=swap" rel="stylesheet" />

        <Sidebar isOpen={isMenuOpen} setIsMenuOpen={setIsMenuOpen} setView={setView} />

        <div className="relative z-10">
          <AppHeader setIsMenuOpen={() => setIsMenuOpen(true)} view={view} />

          <div className="h-[calc(100%-68px)] overflow-y-auto">{renderView()}</div>
        </div>
      </div>
    </div>
  );
}

